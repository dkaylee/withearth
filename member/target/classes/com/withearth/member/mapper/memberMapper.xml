<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.withearth.member.dao.MemberDAO">

<!-- 로그인할때 사용2) Member타입의 resultMap 왜써야 하는건지 모르겠어요-->
<!-- 변수와 컬럼이름이 일치하지 않을때 사용하는 것! 그렇지만 우리는 일치하므로 쓰지 않아도 됨 -->
<resultMap id="memberResult"
			type="com.withearth.member.domain.Member">
	<id column="idx" property="idx"/>
	<result column="id" property="id"/>
	<result column="pw" property="pw"/>
	<result column="name" property="name"/>
	<result column="photo" property="photo"/>
</resultMap>

<!-- 회원가입 -->

<insert id="insertMember"
	parameterType="com.withearth.member.domain.Member"
	useGeneratedKeys="true"
	keyProperty="idx"
	>
<if test="photo != null and logintype=='email'">
INSERT INTO USER (id,pw,name,photo,logintype,code) 
VALUES( #{id}, #{pw}, #{name}, #{photo}, #{logintype}, #{code})
</if>
<if test="photo == null and logintype=='email'">
INSERT INTO USER (id,pw,name,logintype,code) 
VALUES( #{id}, #{pw}, #{name}, #{logintype}, #{code} )
</if>
<if test="logintype=='kakao'">
INSERT INTO USER (id,name,photo,logintype,verify) 
VALUES( #{id}, #{name}, #{photo}, #{logintype}, #{verify} )
</if>
<if test="logintype=='google'">
INSERT INTO USER (id,name,photo,logintype,verify) 
VALUES( #{id}, #{name}, #{photo}, #{logintype}, #{verify} )
</if>
<if test="logintype=='naver'">
INSERT INTO USER (id,name,photo,logintype,verify) 
VALUES( #{id}, #{name}, #{photo}, #{logintype}, #{verify} )
</if>
</insert>

<!-- 로그인 -->
<select id="selectLogin"
		resultMap="memberResult"> <!-- id와 매핑된다. -->

select * from user where id= #{param1}
</select>

<!-- 아이디 중복체크 / 이메일 보내기-->
<select id="selectMemberByIdCount" resultType="int">
	select count(*) from user where id = #{id}
</select>

<!-- 아이디 패스워드 일치여부확인  (안쓰고있음)-->
<select id="selectMemberByIdPwCount" resultType="int">
	select count(*) from user where id= #{param1} and pw=#{param2}
</select>

<!-- 아이디/패스워드 일치 + verify='N'인 경우 -->
<select id="selectMemberByIdPwVerifyCount" resultType="int">
	select count(*) from user where id= #{param1} and pw=#{param2} and verify='N'
</select>
<!-- 이메일 인증 -->
	<select id="selectMemberByIdxVerify"
					resultType="int"
	>
		select count(*) from user where idx=#{idx} and verify='Y'
	</select>
	
	<update id="updateMemberVerify">
		update user set verify='Y' where idx=#{param1} and code=#{param2}
	</update>
	
<!-- 임시 비밀번호 설정 -->	
<update id="updateMembertemporaryPW"
		parameterType="com.withearth.member.domain.TemporaryPw">
		update user set pw=#{tpw} where id=#{id}
</update>

<!-- 카카오 이메일 중복 인증 -->
<select id="kakaoRegCheckCount"
					resultType="int">
		select count(*) from user where id=#{id} and logintype='kakao'
</select>

<!-- 카카오 로그인 인증 -->
<select id="kakaoSelectLogin" resultMap="memberResult"> 
		select * from user where id=#{id}
</select>

<!-- 구글 이메일 중복 인증 -->
<select id="googleRegCheckCount"
					resultType="int">
		select count(*) from user where id=#{id} and logintype='google'
</select>

<!-- 구글 로그인 인증 -->
<select id="googleSelectLogin" resultMap="memberResult"> 
		select * from user where id=#{id}
</select>

<select id="emailUserCheckCount"
					resultType="int">
		select count(*) from user where id=#{id} and logintype='email'
</select>


<!-- 아이디만 가져와서 암호화된 비밀번호와 비교 -->
<select id="compareSecretpw" resultMap="memberResult"> 
		select * from user where id=#{id}
</select>

<!-- 혹시 탈퇴한 회원이세요? -->
<select id="leaveuserselect" resultType="int">
		select count(*) from user where id=#{id} and verify='D'
</select>

<!-- 네이버 이메일 중복 인증 -->
<select id="naverRegCheckCount"
					resultType="int">
		select count(*) from user where id=#{id} and logintype='naver'
</select>

<!-- 네이버 로그인 인증 -->
<select id="naverSelectLogin" resultMap="memberResult"> 
		select * from user where id=#{id}
</select>

</mapper>